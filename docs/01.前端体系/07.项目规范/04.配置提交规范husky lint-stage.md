## é…ç½® Husky

- å›¢é˜Ÿåä½œæ—¶ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¤šç§é—®é¢˜ï¼Œæœ€è®©äººéš¾å—çš„å°±æ˜¯æ¯ä¸ªäººä¹¦å†™çš„ä»£ç é£æ ¼ä¸ä¸€è‡´ğŸ˜…ï¼Œä½¿ç”¨çš„è§„èŒƒä¸ä¸€è‡´ï¼Œå¯¼è‡´å›¢é˜Ÿåä½œæ•ˆç‡æä½ï¼Œä»£ç å¯è¯»æ€§å·®ã€‚
- è¿™æ—¶å€™å°±éœ€è¦ Husky æ¥å¸®å¿™äº†ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ä»£ç æäº¤å‰åè¿›è¡Œä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œï¼Œåƒæ˜¯ä»£ç é£æ ¼çš„æ ¡éªŒï¼Œå¹¶ä¸”å®ƒæ”¯æŒæ‰€æœ‰çš„ Git é’©å­ï¼ˆé’©å­æ˜¯ä½ å¯ä»¥æ”¾åœ¨é’©å­ç›®å½•ä¸­è§¦å‘çš„ç¨‹åº åœ¨ Git æ‰§è¡Œçš„æŸäº›ç‚¹æ‰§è¡Œçš„æ“ä½œï¼‰ã€‚

Gitå…¨éƒ¨é’©å­çš„è¯¦ç»†ä»‹ç»ï¼š[Git - githooks Documentation (git-scm.com)](https://git-scm.com/docs/githooks)
**æœ¬æ–‡ç”¨åˆ°çš„é’©å­**ï¼š

- åœ¨ pre-commit è§¦å‘æ—¶è¿›è¡Œä»£ç æ ¼å¼éªŒè¯ï¼Œåœ¨ commit-msg è§¦å‘æ—¶å¯¹ commit æ¶ˆæ¯å’Œæäº¤ç”¨æˆ·è¿›è¡ŒéªŒè¯ã€‚
  
| git hook | æ‰§è¡Œæ—¶æœŸ | å¤‡æ³¨ |
  | --- | --- | --- |
  | pre-commit | git commit æ‰§è¡Œå‰ | git commit --no verify å‘½ä»¤å¯ä»¥ç»•è¿‡è¯¥é’©å­ |
  | commit-msg | git commit æ‰§è¡Œå‰ | git commit --no verify å‘½ä»¤å¯ä»¥ç»•è¿‡è¯¥é’©å­ |

### å®‰è£…ä¾èµ–
```bash
pnpm install -D husky
```
ç„¶åé…ç½®ä¸€ä¸ªåˆå§‹åŒ– Hysky çš„å‘½ä»¤
```json
// package.json
{
  "script": {
    "prepare": "husky install"
  }
}
```
è¿è¡Œè¿™ä¸ªå‘½ä»¤
```bash
# è¿è¡Œåä¼šåˆå§‹åŒ–husky
pnpm run prepare
```
è¿è¡Œä¹‹åå°±ä¼šå‡ºç°.huskyæ–‡ä»¶å¤¹ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥é…ç½®åœ¨GItHookä¸­æ‰§è¡Œçš„æ“ä½œå•¦ğŸ˜€ã€‚
## é…ç½® LintStaged

- æœ‰äº›åŒå­¦æ„Ÿè§‰ä½¿ç”¨IDEçš„ä¿å­˜è‡ªåŠ¨ä¿®å¤ç›¸å½“éº»çƒ¦ï¼Œæˆ‘æ¯æ¬¡æ”¹å®Œä¹‹åéƒ½éœ€è¦ç­‰ä»–ä¿®å¤ä¸€ä¸‹ğŸ˜¡ï¼Œå¤ªä¸æ–¹ä¾¿å•¦ï¼
- æ¥ä¸‹æ¥å°±è¦è¯·å‡ºæˆ‘ä»¬çš„å¥½å¸®æ‰‹ï¼šlint-stagedï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ git ç¼“å­˜ä¸­è¿›è¡Œä»£ç è´¨é‡ä¸é£æ ¼çš„ä¿®å¤ï¼Œåœ¨ä»£ç æäº¤å‰è¿›è¡Œç»Ÿä¸€æ ¡éªŒï¼Œé€šè¿‡åæ‰å¯ä»¥æäº¤ã€‚
### å®‰è£…ä¾èµ–
```bash
pnpm install -D lint-staged
```
### é…ç½®
åœ¨ package.json é…ç½®ä¸€ä¸ªæŒ‡ä»¤æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨
```json
{
  "script":{
    "lint:lint-staged": "lint-staged",
  }
}
```
ä½¿ç”¨ husky é…ç½®ä¸€ä¸ª pre-commit é’©å­
```sql
# --no-install ä»£è¡¨å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ¨¡å—
npx husky add .husky/pre-commit "npm run lint:lint-staged"
```
LintStaged çš„é…ç½®æ–‡ä»¶æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼š

- åœ¨ package.json ä¸­é…ç½®
- lint-staged.js æˆ– lint-staged.config.js
- .lintstagedrc.json æˆ– .lintstagedrc.yaml

è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨ package.json ä¸­é…ç½®
```json
// æˆ‘ä»¬ç›´æ¥é…ç½®åœ¨ package.json ä¸­
/*
é…ç½®çš„å«ä¹‰ï¼š
<éœ€è¦æ‰§è¡Œçš„æ–‡ä»¶>: <å¯¹åº”æ–‡ä»¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤æ•°ç»„>
*/
"lint-staged": {
  "*.{js,jsx,ts,tsx}": [
    "eslint --fix",
    "prettier --write"
  ],
  "{!(package)*.json,*.code-snippets,.!(browserslist)*rc}": [
    "prettier --write--parser json"
  ],
  "package.json": [
    "prettier --write"
  ],
  "*.vue": [
    "eslint --fix",
    "prettier --write",
    "stylelint --fix"
  ],
  "*.{scss,less,styl,html}": [
    "stylelint --fix",
    "prettier --write"
  ],
  "*.md": [
    "prettier --write"
  ]
}
```
è¿™æ ·å°±é…ç½®å®Œæ¯•å•¦ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ git commit -m "xxx" æ—¶ï¼Œlint-staged ä¼šè‡ªåŠ¨æ‰§è¡Œå¸®æˆ‘ä»¬è¿›è¡Œä»£ç è´¨é‡ä¸é£æ ¼çš„ä¿®å¤ã€‚

## é…ç½® CommitLint

- æ¯æ¬¡çœ‹ Github ä»“åº“çš„æ—¶å€™ï¼Œæ€»æ„Ÿè§‰æœ‰äº›ä¸é¡ºçœ¼ã€‚åŸæ¥æ˜¯æäº¤é™„å¸¦çš„ä¿¡æ¯ä¹±ç³Ÿç³Ÿçš„ï¼Œéƒ½æ˜¯"æ–°å¢xxåŠŸèƒ½"ï¼Œ"ä¿®å¤xxBUG"ï¼Œéå¸¸çš„ä¸å·¥æ•´ï¼Œçœ‹ç€å¤ªä¸èˆ’æœå•¦ğŸ¤¯ã€‚
- ä¸è¦æ…Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CommitLint å¯¹æäº¤çš„ä¿¡æ¯è¿›è¡Œè§„èŒƒã€‚
- å®˜æ–¹æ–‡æ¡£ï¼š[commitlint - Lint commit messages](https://commitlint.js.org/#/)
### å®‰è£…ä¾èµ–
```bash
pnpm install -D @commitlint/cli  @commitlint/config-conventional
```

- @commitlint/config-conventionalï¼šcommitlintè‡ªå®šä¹‰é…ç½®è§„åˆ™æ’ä»¶
### é…ç½®
#### è§„åˆ™é…ç½®

- CommitLinté…ç½®æ–‡ä»¶åç§°å¯ä»¥ä¸ºï¼š.commitlintrc.jsã€.commitlint.config.js ï¼ˆæ ¹æ®ä¸ªäººä¹ æƒ¯é€‰æ‹©å³å¯ï¼‰

**é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹**

- å®˜æ–¹æ–‡æ¡£çš„é…ç½®è§„åˆ™è®²è§£ï¼š[Rules (commitlint.js.org)](https://commitlint.js.org/#/reference-rules?id=rules)

è§„åˆ™ç”±åç§°å’Œé…ç½®æ•°ç»„ç»„æˆï¼š
<é…ç½®åç§°>: [<è­¦æŠ¥çº§åˆ«>, <æ˜¯å¦å¯ç”¨>, <è§„åˆ™å¯¹åº”çš„å€¼>]

- è­¦æŠ¥çº§åˆ«
  - 0 æ— æç¤º disable
  - 1 è­¦å‘Š warning
  - 2 é”™è¯¯ error
- æ˜¯å¦å¯ç”¨
  - always å¯ç”¨
  - never ç¦ç”¨
- è§„åˆ™å¯¹åº”çš„å€¼ï¼šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œé…ç½®
```javascript
// è¿™é‡Œæ˜¯é€šä¿—çš„è§£é‡Š è¯¦æƒ…è¯·å‰å¾€å®˜æ–¹æ–‡æ¡£æŸ¥é˜…
module.exports = {
  ignores: [(commit) => commit.includes('init')],
  extends: ['@commitlint/config-conventional'],
  rules: {
    // ä¿¡æ¯ä»¥ç©ºæ ¼å¼€å¤´
    'body-leading-blank': [2, 'always'],
    'footer-leading-blank': [2, 'always'],
    // ä¿¡æ¯æœ€å¤§é•¿åº¦
    'header-max-length': [2, 'always', 108],
    // ä¿¡æ¯ä¸èƒ½æœªç©º
    'subject-empty': [2, 'never'],
    // ä¿¡æ¯ç±»å‹ä¸èƒ½æœªç©º
    'type-empty': [2, 'never'],
    // æäº¤ä¿¡æ¯çš„ç±»å‹ ä¸‹æ–‡æœ‰ä»‹ç»
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'perf',
        'style',
        'docs',
        'test',
        'refactor',
        'build',
        'ci',
        'chore',
        'revert',
        'wip',
        'workflow',
        'types',
        'release',
        'temp'
      ],
    ],
  },
};
```
**æäº¤ä¿¡æ¯çš„ç±»å‹ä¸€èˆ¬æœ‰å¦‚ä¸‹è§„èŒƒ**ï¼ˆå¯æ ¹æ®å›¢é˜Ÿä¹ æƒ¯è¿›è¡Œæ›´æ”¹ï¼‰ï¼š

- feat : å¢åŠ ä¸€ä¸ªæ–°ç‰¹æ€§
- fix : ä¿®å¤ä¸€ä¸ª bug
- perf : æ›´æ”¹ä»£ç ä»¥æé«˜æ€§èƒ½
- build : æ›´æ”¹æ„å»ºç³»ç»Ÿå’Œå¤–éƒ¨ä¾èµ–é¡¹ï¼ˆå¦‚å°† gulp æ”¹ä¸º webpackï¼Œæ›´æ–°æŸä¸ª npm åŒ…ï¼‰
- ci : å¯¹ CI é…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„æ›´æ”¹
- docs : ä»…ä»…ä¿®æ”¹æ–‡æ¡£è¯´æ˜
- refactor : ä»£ç é‡æ„æ—¶ä½¿ç”¨
- style : ä¸å½±å“ä»£ç å«ä¹‰çš„æ”¹åŠ¨ï¼Œä¾‹å¦‚å»æ‰ç©ºæ ¼ã€æ”¹å˜ç¼©è¿›ã€å¢åˆ åˆ†å·
- test : å¢åŠ æ–°çš„æµ‹è¯•åŠŸèƒ½æˆ–æ›´æ”¹åŸæœ‰çš„æµ‹è¯•æ¨¡å—
- temp: ä¸´æ—¶çš„æäº¤

![git-](https://angelingRemon.github.io/picx-images-hosting/git-.5j46jehif0.png))
### é’©å­é…ç½®
```bash
# é…ç½® commit-msg é’©å­ è¿è¡Œ commitlint
# --no-install ä»£è¡¨å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ¨¡å—
npx husky add .husky/commit-msg "npx --no-install commitlint --edit $1"
```
é…ç½®å®Œæˆåæˆ‘ä»¬å°±å¯ä»¥åœ¨git commitæ—¶è¿›è¡Œä¿¡æ¯çš„è§„èŒƒ
æˆ‘ä»¬éœ€è¦æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿›è¡Œæäº¤ï¼š
```bash
# git commit -m "ç±»å‹: ä¿¡æ¯"
# æ–°å¢åŠŸèƒ½ç¤ºä¾‹
git commit -m "feat: æ–°å¢ç”¨æˆ·ç™»å½•åŠŸèƒ½"
# ä¿®å¤Bugç¤ºä¾‹
git commit -m "fix: ä¿®å¤é¦–é¡µç”¨æˆ·å¤´åƒä¸æ˜¾ç¤ºé—®é¢˜"
```
##  